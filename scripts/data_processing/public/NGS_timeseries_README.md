# Description of scripts used to generate NGS timeseries data

### `gisaid_worldbank_dictionary.R` (run first)

Runs `PPI/auto_extract_gisaid_metadata.R` and then imports `data/raw/metadata.csv`, <https://raw.githubusercontent.com/dsbbfinddx/FINDCov19TrackerData/master/processed/data_all.csv>, and [data/additional_sources/WB_class_data.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/NGS-Capacity-map/main/data/additional_sources/WB_class_data.csv). This outputs a table of all countries present in the FIND testing data and GISAID sequencing data, their country codes, and their world bank income level: [gisaid_countries.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/gisaid_countries.csv).

### `gisaid_sequence_counter.R` (run second)

Runs `PPI/auto_extract_gisaid_metadata.R` and then imports `data/raw/metadata.csv`. For each date for each country in the GISAID data, calculates the number of sequences that have been submitted by that date that were collected in the previous 30 days. The results are output as [countries_seqs.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/countries_seqs.csv).

## The following scripts produce the results used in the NGS timeseries visualizations and can be run in any order.

### `cumulative_sequences_by_incomegroup.R`

Runs `PPI/auto_extract_gisaid_metadata.R` and then imports `data/raw/metadata.csv` and [gisaid_countries.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/gisaid_countries.csv). Outputs [sequences_by_month.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/sequences_by_month.csv) and [cumulative_sequences.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/cumulative_sequences.csv) which are used to generate the [Sequences Submission Timeseries flourish story](https://public.flourish.studio/story/1664349/).

### `metrics_by_income_group_timeseries.R`

Imports [gisaid_countries.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/gisaid_countries.csv), <https://raw.githubusercontent.com/dsbbfinddx/FINDCov19TrackerData/master/processed/data_all.csv>, <https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv> and [countries_seqs.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/countries_seqs.csv). Outputs [metrics_timeseries.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/metrics_timeseries.csv), which is used to generate the [Metrics Timeseries flourish chart](https://public.flourish.studio/visualisation/10679226/).

### `archetypes_over_time.R`

Runs `PPI/auto_extract_gisaid_metadata.R` and then imports `data/raw/metadata.csv`, [gisaid_countries.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/gisaid_countries.csv), <https://raw.githubusercontent.com/dsbbfinddx/FINDCov19TrackerData/master/processed/data_all.csv>, <https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv> and [data/additional_sources/Sequencing_labs_data.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/NGS-Capacity-map/main/data/additional_sources/Sequencing_labs_data.csv). Outputs [sequencing_archetypes.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/sequencing_archetypes.csv), [testing_archetypes.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/testing_archetypes.csv), [sequencing_archetypes_pop.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/sequencing_archetypes_pop.csv), [testing_archetypes_pop.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/testing_archetypes_pop.csv), [sequencing_archetypes_byincome.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/sequencing_archetypes_byincome.csv), and [testing_archetypes_byincome.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/testing_archetypes_byincome.csv). [sequencing_archetypes_pop.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/sequencing_archetypes_pop.csv) and [testing_archetypes_pop.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/testing_archetypes_pop.csv) are used to generate the [Archetypes Over Time flourish story](https://public.flourish.studio/story/1664428/), [sequencing_archetypes_pop.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/sequencing_archetypes_pop.csv) and [sequencing_archetypes_byincome.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/sequencing_archetypes_byincome.csv) are used to generate the [NGS Archetypes over time flourish story](https://public.flourish.studio/story/1665386/), and [testing_archetypes_pop.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/testing_archetypes_pop.csv) and [testing_archetypes_byincome.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/testing_archetypes_byincome.csv) are used to generate the [Testing Archetypes over time flourish story](https://public.flourish.studio/story/1665411/). [sequencing_archetypes.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/sequencing_archetypes.csv) and [testing_archetypes.csv](https://raw.githubusercontent.com/PandemicPreventionInstitute/ppi-output/main/timeseries/testing_archetypes.csv) are used to generate the [NGS Archetypes](https://public.flourish.studio/visualisation/10694441/) and [Testing Archetypes](https://public.flourish.studio/visualisation/10694500/) flourish charts, respectively.
